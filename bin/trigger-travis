#!/usr/bin/env node

const pkginfo = require('pkginfo')(module),
    trigger = require('../lib/trigger'),
    ArgumentParser = require('argparse').ArgumentParser,
    yaml = require('js-yaml'),
    parser = new ArgumentParser({
        version: this.version,
        addHelp: true,
        description: this.description
    });

//args


parser.addArgument(['-r', '--repo'], {
    help: 'The name of the repo e.g. ishmael-readingplus/[trigger-travis]',
    required: true
});
parser.addArgument(['-o', '--owner'], {
    help: 'The owner of the github repo e.g [ishmael-readingplus]/trigger-travis',
    required: true
});
parser.addArgument(['-t', '--token'], {
    help: 'Travis api token',
    required: true
});
parser.addArgument(['-b', '--branch'], {
    help: 'The name of the branch to trigger by default it uses the upstream master branch',
    defaultValue: 'master'
});
parser.addArgument(['--pro'], {
    help: 'Set if the repo is on github.com the default is github.org',
    defaultValue: false,
    action: 'storeTrue',
    type: Boolean
});
parser.addArgument(['--debug'], {
    help: 'Prints message to the console, but takes no action',
    defaultValue: false,
    action: 'storeTrue',
    type: Boolean
});
parser.addArgument(['-c','--config'], {
    help: 'A config in YAML format as discribed here https://docs.travis-ci.com/user/triggering-builds',
    // CLI interface takes YAML string but when calling pull() programmatically you should pass a JS object.
    type: yaml.safeLoad,
    defaultValue: {},
});

var argv = parser.parseArgs();
trigger.pull(argv);
